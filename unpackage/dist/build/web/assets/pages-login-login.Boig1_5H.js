import{i as e,r as o,p as a,d as s,c as l,w as t,o as r,a as i,b as d,e as n,f as u,n as c,u as p,g as m,h as v,j as f,t as b,k as g,l as w,m as _}from"./index-4xE3Jiky.js";import{_ as y,a as h,b as k,r as N,c as j,s as x}from"./request.BbQ2wDkA.js";import{m as C,a as I,b as O,c as T,d as V,i as z,e as P,f as $,_ as H,r as U}from"./useChildren.ogl1P_NW.js";import{_ as q}from"./wd-cell-group.D_l0hBOq.js";import{_ as A}from"./wd-form.D0YxAQUM.js";import"./index.ClTUV6O_.js";import{s as F}from"./user.DXF9pBdN.js";import"./wd-toast.CSdeP_zF.js";const S={type:C("danger"),color:C(""),zIndex:I(99),visible:O(!1),message:T(""),selector:C(""),duration:I(3e3),position:C("top"),safeHeight:Number,background:C(""),rootPortal:O(!1)};let Y,E={type:"danger",color:void 0,zIndex:99,message:"",duration:3e3,position:"top",safeHeight:void 0,background:void 0,onClick:void 0,onClosed:void 0,onOpened:void 0};const G=Symbol("None"),L=e=>e?`__NOTIFY_OPTION__${e}`:"__NOTIFY_OPTION__";const B=H(s({name:"wd-notify",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:S,emits:["update:visible","click","closed","opened"],setup(a,{emit:s}){const g=a,w=s,_=e(L(g.selector),o(g)),h=l((()=>{const{safeHeight:e,position:o}=_.value;let a="";switch(o){case"top":a=`top: calc(var(--window-top) + ${$(e||0)})`;break;case"bottom":a="bottom: var(--window-bottom)"}return a})),k=e=>{if(P(_.value.onClick))return _.value.onClick(e);w("click",e)},N=()=>{if(P(_.value.onClosed))return _.value.onClosed();w("closed")},j=()=>{if(P(_.value.onOpened))return _.value.onOpened();w("opened")};return t((()=>_.value.visible),(e=>{w("update:visible",e)}),{deep:!0}),(e,o)=>{const a=v;return r(),i(y,{modelValue:p(_).visible,"onUpdate:modelValue":o[0]||(o[0]=e=>p(_).visible=e),"custom-style":h.value,position:p(_).position,"z-index":p(_).zIndex,duration:250,modal:!1,"root-portal":p(_).rootPortal,onLeave:N,onEnter:j},{default:d((()=>[n(a,{class:c(["wd-notify",[`wd-notify--${p(_).type}`]]),style:m({color:p(_).color,background:p(_).background}),onClick:k},{default:d((()=>[u(e.$slots,"default",{},(()=>[f(b(p(_).message),1)]),!0)])),_:3},8,["class","style"])])),_:3},8,["modelValue","custom-style","position","z-index","root-portal"])}}}),[["__scopeId","data-v-d4d03075"]]),D=H(s({__name:"login",setup(s){const{showNotify:l,closeNotify:t}=((s="")=>{const l=L(s),t=e(l,o(G));t.value===G&&(t.value=E,a(l,t));const r=()=>{Y&&clearTimeout(Y),t.value!==G&&(t.value.visible=!1)};return{showNotify:e=>{const o=V(E,z(e)?{message:e}:e);t.value=V(o,{visible:!0}),t.value.duration&&t.value.duration>0&&(Y&&clearTimeout(Y),Y=setTimeout((()=>r()),o.duration))},closeNotify:r}})(),u=g({loginName:"",password:""}),c=o(),p=o(!1);function m(){c.value.validate().then((({valid:e,errors:o})=>{e&&(p.value=!0,N({url:`/${j.mesUser}/sys/user/authenticate`,data:u,needAuth:!1,method:"POST"}).then((({user:e,Authorization:o})=>{l({type:"success",message:"登录成功"}),F(e),x(o),_({url:"/pages/inspectionTask/inspectionTask"})})).finally((()=>{p.value=!1})))})).catch((e=>{console.log(e,"error")}))}return(e,o)=>{const a=U(w("wd-input"),h),s=U(w("wd-cell-group"),q),l=U(w("wd-button"),k),t=v,b=U(w("wd-form"),A),g=U(w("wd-notify"),B);return r(),i(t,{class:"login-view"},{default:d((()=>[n(b,{ref_key:"form",ref:c,model:u},{default:d((()=>[n(s,{border:""},{default:d((()=>[n(a,{label:"用户名","label-width":"100px",prop:"loginName",clearable:"",modelValue:u.loginName,"onUpdate:modelValue":o[0]||(o[0]=e=>u.loginName=e),placeholder:"请输入用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),n(a,{label:"密码","label-width":"100px",prop:"password","show-password":"",clearable:"",modelValue:u.password,"onUpdate:modelValue":o[1]||(o[1]=e=>u.password=e),placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"])])),_:1}),n(t,{class:"footer"},{default:d((()=>[n(l,{type:"primary",size:"large",loading:p.value,onClick:m,block:""},{default:d((()=>[f("登录")])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"]),n(g)])),_:1})}}}),[["__scopeId","data-v-7b201ba6"]]);export{D as default};
