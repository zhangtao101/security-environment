import{r as e,q as l,C as a,l as o,a as s,b as r,h as u,o as t,e as i,j as d,s as n,v as m}from"./index-BP_ofNMV.js";import{_ as p,a as c,f as v}from"./wd-datetime-picker.C9Z9yD_Y.js";import{r as f}from"./useChildren.CAjn426h.js";import{r as g,a as h,b,d as _,c as V}from"./request.D2K8nqXq.js";import{_ as w}from"./wd-textarea.BlajM10V.js";import{_ as T}from"./wd-upload.Bm8wM8pF.js";import{_ as j}from"./wd-cell.RGUuOR8c.js";import{_ as y}from"./wd-form.BMurKPHh.js";import{_ as k}from"./wd-message-box.BqT4QVFO.js";import{_ as x}from"./wd-toast.CNyXT4Ng.js";/* empty css                                                               */import{f as U}from"./tree.DlTOYXzf.js";import"./index.ClTUV6O_.js";const q={__name:"riskReporting",setup(q){const C=e({discoverTime:"",discoverer:[]}),S=e(),z=e(0);function E(){S.value.validate().then((({valid:e,errors:l})=>{if(e){const e={...C.value,executionId:z.value};e.discoverTime=v(e.discoverTime),e.discoverer=e.discoverer[1],e.photoList=[],O.value.forEach((l=>{if(l.response){const a=JSON.parse(l.response);e.photoList.push(a.data)}else e.photoList.push(l.url)}));const l=`/${V.mesMain}/risk/report/insert`;g({url:l,data:e,needAuth:!0,method:"POST"}).then((e=>{_({msg:"上报成功!"}),n({delta:1})}))}})).catch((e=>{console.log(e,"error")}))}const L=e([[{label:"请选择",value:-1}],[{label:"请选择",value:-1}]]);function N(e,l,a,o){const s=l[a];var r,u;0===a&&(r=s.value,u=l=>{e.setColumnData(1,l)},g({url:`/${V.mesUser}/sys/person/listSysPerson`,data:{orgCode:r,pageNum:1,pageSize:999},needAuth:!0,method:"GET"}).then((({list:e})=>{const l=[{label:"请选择",value:-1}];e.length>0&&e.forEach((e=>{l.push({label:e.perName,value:e.perName})})),u(l)})))}const $=e([{label:"人",value:"人"},{label:"物",value:"物"},{label:"环",value:"环"},{label:"管",value:"管"}]),F=e([{label:"一般隐患",value:1},{label:"严重隐患",value:2},{label:"较大隐患",value:3},{label:"重大隐患",value:4}]);const O=e([]),A=`${V.baseURL}/${V.mesMain}/accident/register/uploadFile`;return l((()=>{C.value.discoverTime=(new Date).getTime(),g({url:`/${V.mesUser}/sys/organization/listTree`,data:{},needAuth:!0,method:"GET"}).then((e=>{const l=U([e]);l.length>0&&(L.value[0]=[{label:"请选择",value:-1}],l.forEach((e=>{L.value[0].push({label:e.orgFullName,value:e.orgCode})})))}));a().proxy.getOpenerEventChannel().on("acceptDataFromOpenerPage",(function(e){z.value=e.id}))})),(e,l)=>{const a=f(o("wd-picker"),p),n=f(o("wd-datetime-picker"),c),v=f(o("wd-input"),h),g=f(o("wd-textarea"),w),_=f(o("wd-upload"),T),V=f(o("wd-cell"),j),U=f(o("wd-button"),b),q=u,z=f(o("wd-form"),y),D=f(o("wd-message-box"),k),P=f(o("wd-toast"),x);return t(),s(q,null,{default:r((()=>[i(q,null,{default:r((()=>[i(z,{ref_key:"form",ref:S,model:C.value,border:""},{default:r((()=>[i(a,{"align-right":"",prop:"discoverer",columns:L.value,label:"上报人员",modelValue:C.value.discoverer,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value.discoverer=e),"column-change":N,placeholder:"请选择上报人员",rules:[{required:!0,message:"请选择上报人员"}]},null,8,["columns","modelValue"]),i(n,{label:"上报时间","align-right":"",modelValue:C.value.discoverTime,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value.discoverTime=e),prop:"discoverTime",rules:[{required:!0,message:"请填写上报时间"}]},null,8,["modelValue"]),i(a,{"align-right":"",columns:$.value,label:"风险类型",modelValue:C.value.riskType,"onUpdate:modelValue":l[2]||(l[2]=e=>C.value.riskType=e),prop:"riskType",rules:[{required:!0,message:"请选择风险类型"}]},null,8,["columns","modelValue"]),i(v,{"align-right":"",modelValue:C.value.location,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value.location=e),label:"发现区域","suffix-icon":"scan",readonly:"",onClick:l[4]||(l[4]=e=>{m({success:function(e){console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),C.value.location=e.result}})}),prop:"location",rules:[{required:!0,message:"请选择发现区域"}]},null,8,["modelValue"]),i(g,{label:"问题描述",modelValue:C.value.description,"onUpdate:modelValue":l[5]||(l[5]=e=>C.value.description=e),placeholder:"请填写详细的问题描述",maxlength:300,clearable:"","show-word-limit":"",prop:"description",rules:[{required:!0,message:"请填写详细的问题描述"}]},null,8,["modelValue"]),i(v,{"align-right":"",modelValue:C.value.hazardSource,"onUpdate:modelValue":l[6]||(l[6]=e=>C.value.hazardSource=e),label:"隐患来源",prop:"hazardSource",rules:[{required:!0,message:"请输入隐患来源"}]},null,8,["modelValue"]),i(a,{"align-right":"",columns:F.value,label:"隐患等级",modelValue:C.value.level,"onUpdate:modelValue":l[7]||(l[7]=e=>C.value.level=e),prop:"level",rules:[{required:!0,message:"请选择隐患等级"}]},null,8,["columns","modelValue"]),i(V,{title:"现场图片上传",top:""},{default:r((()=>[i(_,{"file-list":O.value,"onUpdate:fileList":l[8]||(l[8]=e=>O.value=e),"image-mode":"aspectFill",action:A,multiple:""},null,8,["file-list"])])),_:1}),i(q,{class:"footer"},{default:r((()=>[i(U,{type:"primary",size:"large",onClick:E,block:""},{default:r((()=>[d("提交")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),i(D),i(P)])),_:1})}}};export{q as default};
