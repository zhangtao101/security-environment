import{r as e,q as l,l as a,a as o,b as s,h as r,o as u,e as t,j as d,s as i,v as n}from"./index-4xE3Jiky.js";import{_ as m,a as c,f as p}from"./wd-datetime-picker.CP4rJPdd.js";import{o as v,r as h}from"./useChildren.ogl1P_NW.js";import{r as f,a as g,b,d as _,c as V}from"./request.BbQ2wDkA.js";import{_ as w}from"./wd-textarea.C2NbIVsl.js";import{_ as T}from"./wd-upload.r7andDs0.js";import{_ as j}from"./wd-cell.D49pC09f.js";import{_ as y}from"./wd-form.D0YxAQUM.js";import{_ as x}from"./wd-message-box.D-XpZhdX.js";import{_ as z}from"./wd-toast.CSdeP_zF.js";/* empty css                                                               */import{f as U}from"./tree.DlTOYXzf.js";import"./index.ClTUV6O_.js";const q={__name:"hazardReporting",setup(q){const k=e({discoverTime:"",discoverer:[]}),S=e(),C=e();function E(){S.value.validate().then((({valid:e,errors:l})=>{if(e){const e={...k.value,executionId:C.value};e.discoverTime=p(e.discoverTime),e.discoverer=e.discoverer[1],F.value.forEach((l=>{if(e.photoList=[],l.response){const a=JSON.parse(l.response);e.photoList.push(a.data)}else e.photoList.push(l.url)}));const l=`/${V.mesMain}/hazard/report/insert`;f({url:l,data:e,needAuth:!0,method:"POST"}).then((e=>{_({msg:"上报成功!"}),i({delta:1})}))}})).catch((e=>{console.log(e,"error")}))}const L=e([[{label:"请选择",value:-1}],[{label:"请选择",value:-1}]]);function N(e,l,a,o){const s=l[a];var r,u;0===a&&(r=s.value,u=l=>{e.setColumnData(1,l)},f({url:`/${V.mesUser}/sys/person/listSysPerson`,data:{orgCode:r,pageNum:1,pageSize:999},needAuth:!0,method:"GET"}).then((({list:e})=>{const l=[{label:"请选择",value:-1}];e.length>0&&e.forEach((e=>{l.push({label:e.perName,value:e.perName})})),u(l)})))}const $=e([{label:"安全",value:"安全"},{label:"环境",value:"环境"},{label:"健康",value:"健康"},{label:"其他",value:"其他"}]),A=e([{label:"一般隐患",value:1},{label:"严重隐患",value:2},{label:"较大隐患",value:3},{label:"重大隐患",value:4}]);const F=e([]),I=`${V.baseURL}/${V.mesMain}/accident/register/uploadFile`;return l((()=>{k.value.discoverTime=(new Date).getTime(),f({url:`/${V.mesUser}/sys/organization/listTree`,data:{},needAuth:!0,method:"GET"}).then((e=>{const l=U([e]);l.length>0&&(L.value[0]=[{label:"请选择",value:-1}],l.forEach((e=>{L.value[0].push({label:e.orgFullName,value:e.orgCode})})))}))})),v((e=>{console.log("接收到的testId参数是：",e),C.value=e.testId})),(e,l)=>{const i=h(a("wd-picker"),m),p=h(a("wd-datetime-picker"),c),v=h(a("wd-input"),g),f=h(a("wd-textarea"),w),_=h(a("wd-upload"),T),V=h(a("wd-cell"),j),U=h(a("wd-button"),b),q=r,C=h(a("wd-form"),y),D=h(a("wd-message-box"),x),G=h(a("wd-toast"),z);return u(),o(q,null,{default:s((()=>[t(q,null,{default:s((()=>[t(C,{ref_key:"form",ref:S,model:k.value,border:""},{default:s((()=>[t(i,{"align-right":"",prop:"discoverer",columns:L.value,label:"上报人员",modelValue:k.value.discoverer,"onUpdate:modelValue":l[0]||(l[0]=e=>k.value.discoverer=e),"column-change":N,placeholder:"请选择上报人员",rules:[{required:!0,message:"请选择上报人员"}]},null,8,["columns","modelValue"]),t(p,{label:"上报时间","align-right":"",modelValue:k.value.discoverTime,"onUpdate:modelValue":l[1]||(l[1]=e=>k.value.discoverTime=e),prop:"discoverTime",rules:[{required:!0,message:"请填写上报时间"}],readonly:""},null,8,["modelValue"]),t(i,{"align-right":"",columns:$.value,label:"隐患类型",modelValue:k.value.hazardType,"onUpdate:modelValue":l[2]||(l[2]=e=>k.value.hazardType=e),prop:"hazardType",rules:[{required:!0,message:"请选择隐患类型"}]},null,8,["columns","modelValue"]),t(v,{"align-right":"",modelValue:k.value.location,"onUpdate:modelValue":l[3]||(l[3]=e=>k.value.location=e),label:"发现区域","suffix-icon":"scan",readonly:"",onClick:l[4]||(l[4]=e=>{n({success:function(e){console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),k.value.location=e.result}})}),prop:"location",rules:[{required:!0,message:"请选择发现区域"}]},null,8,["modelValue"]),t(f,{label:"问题描述",modelValue:k.value.description,"onUpdate:modelValue":l[5]||(l[5]=e=>k.value.description=e),placeholder:"请填写详细的问题描述",maxlength:300,clearable:"","show-word-limit":"",prop:"description",rules:[{required:!0,message:"请填写详细的问题描述"}]},null,8,["modelValue"]),t(v,{"align-right":"",modelValue:k.value.hazardSource,"onUpdate:modelValue":l[6]||(l[6]=e=>k.value.hazardSource=e),label:"隐患来源",prop:"hazardSource",rules:[{required:!0,message:"请输入隐患来源"}]},null,8,["modelValue"]),t(i,{"align-right":"",columns:A.value,label:"隐患等级",modelValue:k.value.level,"onUpdate:modelValue":l[7]||(l[7]=e=>k.value.level=e),prop:"level",rules:[{required:!0,message:"请选择隐患等级"}]},null,8,["columns","modelValue"]),t(V,{title:"现场图片上传",top:""},{default:s((()=>[t(_,{"file-list":F.value,"onUpdate:fileList":l[8]||(l[8]=e=>F.value=e),"image-mode":"aspectFill",action:I},null,8,["file-list"])])),_:1}),t(q,{class:"footer"},{default:s((()=>[t(U,{type:"primary",size:"large",onClick:E,block:""},{default:s((()=>[d("提交")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),t(D),t(G)])),_:1})}}};export{q as default};
