import{r as e,q as l,C as a,l as o,a as s,b as t,A as u,h as r,o as i,e as d,j as n,x as m,s as c,B as p,v}from"./index-BP_ofNMV.js";import{r as g,c as h,a as f,b}from"./request.D2K8nqXq.js";import{l as k,n as V,r as y}from"./useChildren.CAjn426h.js";import{_}from"./wd-select-picker.XdlqHHzA.js";import{_ as w}from"./wd-textarea.BlajM10V.js";import{_ as U}from"./wd-cell.RGUuOR8c.js";import{_ as j}from"./wd-upload.Bm8wM8pF.js";import{_ as x}from"./wd-form.BMurKPHh.js";import{_ as C}from"./wd-message-box.BqT4QVFO.js";import{u as L,_ as T}from"./wd-toast.CNyXT4Ng.js";import"./index.ClTUV6O_.js";const R={__name:"riskInspectionDetails",setup(R){e(-1);const{success:$}=L(),q=e(),E=e(),O=e();function A(){E.value.validate().then((({valid:e,errors:l})=>{if(e){const e=`/${h.mesMain}/riskcheck/execution/update`,l={...q.value};l.photoList=[],M.value.forEach((e=>{if(e.response){const a=JSON.parse(e.response);l.photoList.push(a.data)}else l.photoList.push(e.url)})),console.log(999),g({url:e,data:l,needAuth:!0,method:"PUT"}).then((e=>{$({msg:"上报成功!"}),setTimeout((()=>{c({delta:1})}),500)}))}})).catch((e=>{console.log(999),console.log(e,"error")}))}function D(){p({url:"/pages/riskReporting/riskReporting",success(e){e.eventChannel.emit("acceptDataFromOpenerPage",{id:q.value.id})}})}const F=[{label:"无风险",value:0},{label:"有风险",value:1}];const M=e([]),P=`${h.baseURL}/${h.mesMain}/accident/register/uploadFile`;function z(){g({url:`/${h.mesMain}/riskcheck/execution/getBy/${O.value}`,data:{},needAuth:!0,method:"GET"}).then((e=>{e||(e={}),e.result=e.result||0===e.result?e.result:1,q.value?q.value.isReport=e.isReport:(M.value=[],e.photoList&&e.photoList.length>0&&e.photoList.forEach((e=>{M.value.push({url:e})})),q.value=e)})).finally((()=>{u()}))}return l((()=>{a().proxy.getOpenerEventChannel().on("acceptDataFromOpenerPage",(function(e){console.log(e,e.id),O.value=e.id,z()}))})),k((()=>{z()})),V((()=>{q.value&&z()})),(e,l)=>{const a=y(o("wd-input"),f),u=y(o("wd-select-picker"),_),c=y(o("wd-textarea"),w),p=y(o("wd-cell"),U),g=y(o("wd-upload"),j),h=y(o("wd-button"),b),k=r,V=y(o("wd-form"),x),L=y(o("wd-message-box"),C),R=y(o("wd-toast"),T);return i(),s(k,null,{default:t((()=>[d(k,{v:""},{default:t((()=>[d(V,{ref_key:"form",ref:E,model:q.value,border:"",disabled:"",v:""},{default:t((()=>[d(a,{"align-right":"",modelValue:q.value.planCheckTime,"onUpdate:modelValue":l[0]||(l[0]=e=>q.value.planCheckTime=e),label:"计划开始时间",readonly:""},null,8,["modelValue"]),d(a,{"align-right":"",modelValue:q.value.checkType,"onUpdate:modelValue":l[1]||(l[1]=e=>q.value.checkType=e),label:"检查类别",readonly:""},null,8,["modelValue"]),d(a,{"align-right":"",modelValue:q.value.checkCriteria,"onUpdate:modelValue":l[2]||(l[2]=e=>q.value.checkCriteria=e),label:"检查标准",readonly:""},null,8,["modelValue"]),d(a,{"align-right":"",modelValue:q.value.checkUser,"onUpdate:modelValue":l[3]||(l[3]=e=>q.value.checkUser=e),label:"检查人",readonly:""},null,8,["modelValue"]),d(a,{"align-right":"",modelValue:q.value.area,"onUpdate:modelValue":l[4]||(l[4]=e=>q.value.area=e),label:"区域",readonly:""},null,8,["modelValue"]),d(a,{"align-right":"",modelValue:q.value.content,"onUpdate:modelValue":l[5]||(l[5]=e=>q.value.content=e),label:"内容",readonly:""},null,8,["modelValue"]),d(u,{"align-right":"",label:"巡检结果",modelValue:q.value.result,"onUpdate:modelValue":l[6]||(l[6]=e=>q.value.result=e),columns:F,"show-confirm":!1,type:"radio",prop:"sign",rules:[{required:!0,message:"请选扫描区域编码"}],disabled:1===q.value.state},null,8,["modelValue","disabled"]),d(p,{title:"备注",top:""},{default:t((()=>[d(c,{modelValue:q.value.remark,"onUpdate:modelValue":l[7]||(l[7]=e=>q.value.remark=e),disabled:1===q.value.state},null,8,["modelValue","disabled"])])),_:1}),d(a,{"align-right":"",modelValue:q.value.sign,"onUpdate:modelValue":l[8]||(l[8]=e=>q.value.sign=e),label:"区域编码","suffix-icon":"scan",readonly:"",onClick:l[9]||(l[9]=e=>{1!==q.value.state&&v({success:function(e){console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),q.value.sign=e.result}})}),prop:"sign",rules:[{required:!0,message:"请选扫描区域编码"}]},null,8,["modelValue"]),d(p,{title:"现场图片上传",top:""},{default:t((()=>[d(g,{"file-list":M.value,"onUpdate:fileList":l[10]||(l[10]=e=>M.value=e),multiple:"",action:P,disabled:1===q.value.state},null,8,["file-list","disabled"])])),_:1}),1!==q.value.state?(i(),s(k,{key:0,class:"footer"},{default:t((()=>[1===q.value.result?(i(),s(h,{key:0,type:"primary",size:"large",onClick:D,block:"",disabled:1===q.value.isReport},{default:t((()=>[n(" 隐患上报 ")])),_:1},8,["disabled"])):m("",!0),d(h,{type:"primary",size:"large",onClick:A,block:"",style:{"margin-top":"1rem"},disabled:1===q.value.result&&1!==q.value.isReport},{default:t((()=>[n("提交")])),_:1},8,["disabled"])])),_:1})):m("",!0)])),_:1},8,["model"])])),_:1}),d(L),d(R)])),_:1})}}};export{R as default};
