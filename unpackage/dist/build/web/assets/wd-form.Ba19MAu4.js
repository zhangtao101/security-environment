import{d as s,k as e,w as o,o as a,a as r,b as t,f as p,x as n,n as l,g as c,h as i}from"./index-Cztqg-WN.js";import{u as m,_ as f}from"./wd-toast.GkP24f1O.js";import{T as u,j as d,D as h,h as g,E as y,U as k,i as w,F as b,P as j,_ as v}from"./useChildren.DGM8SC5-.js";const x=v(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:u,setup(s,{expose:u}){const{show:v}=m("wd-form-toast"),x=s,{children:E,linkChildren:_}=d(j);let C=e({});function O(s){s?C[s]="":Object.keys(C).forEach((s=>{C[s]=""}))}return _({props:x,errorMessages:C}),o((()=>x.model),(()=>{x.resetOnChange&&O()}),{immediate:!0,deep:!0}),u({validate:async function(s){const e=[];let o=!0;const a=[],r=function(){const s=b(x.rules),e=E.map((s=>s.prop));return Object.keys(s).forEach((o=>{e.includes(o)||delete s[o]})),E.forEach((e=>{g(e.prop)&&g(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),t=h(s)?s:g(s)?[s]:[],p=t.length>0?t.reduce(((s,e)=>(r[e]&&(s[e]=r[e]),s)),{}):r;for(const n in p){const s=p[n],r=y(x.model,n);if(s&&s.length>0)for(const t of s){if(t.required&&(!g(r)||""===r)){e.push({prop:n,message:t.message}),o=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:n,message:t.message}),o=!1;break}const{validator:s,...p}=t;if(s){const l=s(r,p);k(l)?a.push(l.then((s=>{"string"==typeof s?(e.push({prop:n,message:s}),o=!1):"boolean"!=typeof s||s||(e.push({prop:n,message:t.message}),o=!1)})).catch((s=>{const a=g(s)?w(s)?s:s.message||t.message:t.message;e.push({prop:n,message:a}),o=!1}))):l||(e.push({prop:n,message:t.message}),o=!1)}}}return await Promise.all(a),function(s){const e=E.map((s=>s.prop)).filter(Boolean),o=s.filter((s=>s.message&&e.includes(s.prop)));o.length&&(o.sort(((s,o)=>e.indexOf(s.prop)-e.indexOf(o.prop))),"toast"===x.errorType?v(o[0].message):"message"===x.errorType&&o.forEach((s=>{C[s.prop]=s.message})))}(e),o&&(t.length?t.forEach(O):O()),{valid:o,errors:e}},reset:function(){O()}}),(s,e)=>{const o=i;return a(),r(o,{class:l(`wd-form ${s.customClass}`),style:c(s.customStyle)},{default:t((()=>[p(s.$slots,"default",{},void 0,!0),"toast"===x.errorType?(a(),r(f,{key:0,selector:"wd-form-toast"})):n("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-176a1352"]]);export{x as _};
