import{r as e,l,a,b as o,h as t,o as s,e as u,j as d,x as r,s as i,B as n,v as c}from"./index-4xE3Jiky.js";import{r as m,c as p,a as h,b as v}from"./request.BbQ2wDkA.js";import{o as g,p as f,r as b}from"./useChildren.ogl1P_NW.js";import{_ as V}from"./wd-select-picker.DCKp3YlI.js";import{_ as k}from"./wd-upload.r7andDs0.js";import{_ as y}from"./wd-cell.D49pC09f.js";import{_}from"./wd-form.D0YxAQUM.js";import{_ as w}from"./wd-message-box.D-XpZhdX.js";import{u as U,_ as j}from"./wd-toast.CSdeP_zF.js";import"./index.ClTUV6O_.js";const C={__name:"inspectionDetails",setup(C){const x=e(-1),{success:L}=U(),z=e(),T=e();function $(){m({url:`/${p.mesMain}/hazardcheck/execution/getBy/${x.value}`,data:{area:""},needAuth:!0,method:"GET"}).then((e=>{console.log(e),e||(e={}),e.result=e.result||0===e.result?e.result:1,e.photoList&&e.photoList.length>0&&(I.value=[],e.photoList.forEach((e=>{I.value.push({url:e})}))),z.value=e}))}function R(){T.value.validate().then((({valid:e,errors:l})=>{if(e){const e={...z.value};I.value.forEach((l=>{if(e.photoList=[],l.response){const a=JSON.parse(l.response);e.photoList.push(a.data)}})),m({url:`/${p.mesMain}/hazardcheck/execution/update`,data:e,needAuth:!0,method:"put"}).then((e=>{L({msg:"上报成功!"}),i({delta:1})}))}})).catch((e=>{console.log(e,"error")}))}function q(){n({url:`/pages/hazardReporting/hazardReporting?testId=${z.value.id}`})}const E=[{label:"无隐患",value:0},{label:"有隐患",value:1}];const I=e([]),M=`${p.baseURL}/${p.mesMain}/accident/register/uploadFile`;return g((e=>{console.log("接收到的testId参数是：",e),x.value=e.testId,$()})),f((()=>{z.value&&$()})),(e,i)=>{const n=b(l("wd-input"),h),m=b(l("wd-select-picker"),V),p=b(l("wd-upload"),k),g=b(l("wd-cell"),y),f=b(l("wd-button"),v),U=t,C=b(l("wd-form"),_),x=b(l("wd-message-box"),w),L=b(l("wd-toast"),j);return s(),a(U,null,{default:o((()=>[u(U,{v:""},{default:o((()=>[u(C,{ref_key:"form",ref:T,model:z.value,border:""},{default:o((()=>[u(n,{"align-right":"",modelValue:z.value.checkCode,"onUpdate:modelValue":i[0]||(i[0]=e=>z.value.checkCode=e),label:"检查编号",placeholder:"",readonly:""},null,8,["modelValue"]),u(n,{"align-right":"",modelValue:z.value.planCheckTime,"onUpdate:modelValue":i[1]||(i[1]=e=>z.value.planCheckTime=e),label:"计划开始时间",placeholder:"",readonly:""},null,8,["modelValue"]),u(n,{"align-right":"",modelValue:z.value.checkType,"onUpdate:modelValue":i[2]||(i[2]=e=>z.value.checkType=e),label:"检查类别",placeholder:"",readonly:""},null,8,["modelValue"]),u(n,{"align-right":"",modelValue:z.value.checkCriteria,"onUpdate:modelValue":i[3]||(i[3]=e=>z.value.checkCriteria=e),label:"检查标准",placeholder:"",readonly:""},null,8,["modelValue"]),u(n,{"align-right":"",modelValue:z.value.checkUser,"onUpdate:modelValue":i[4]||(i[4]=e=>z.value.checkUser=e),label:"检查人",placeholder:"",readonly:""},null,8,["modelValue"]),u(n,{"align-right":"",modelValue:z.value.area,"onUpdate:modelValue":i[5]||(i[5]=e=>z.value.area=e),label:"区域",placeholder:"",readonly:""},null,8,["modelValue"]),u(n,{"align-right":"",modelValue:z.value.content,"onUpdate:modelValue":i[6]||(i[6]=e=>z.value.content=e),label:"内容",placeholder:"",readonly:""},null,8,["modelValue"]),u(m,{"align-right":"",label:"巡检结果",modelValue:z.value.result,"onUpdate:modelValue":i[7]||(i[7]=e=>z.value.result=e),columns:E,"show-confirm":!1,type:"radio",prop:"result",rules:[{required:!0,message:"请选择巡检结果"}],disabled:1===z.value.state},null,8,["modelValue","disabled"]),u(n,{"align-right":"",modelValue:z.value.remark,"onUpdate:modelValue":i[8]||(i[8]=e=>z.value.remark=e),label:"备注",disabled:1===z.value.state},null,8,["modelValue","disabled"]),u(n,{"align-right":"",modelValue:z.value.sign,"onUpdate:modelValue":i[9]||(i[9]=e=>z.value.sign=e),label:"区域编码","suffix-icon":"scan",readonly:"",onClick:i[10]||(i[10]=e=>{1!==z.value.state&&c({success:function(e){console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),z.value.sign=e.result}})}),prop:"sign",rules:[{required:!0,message:"请扫描区域编码"}],disabled:1===z.value.state},null,8,["modelValue","disabled"]),u(g,{title:"现场图片上传",top:""},{default:o((()=>[u(p,{"file-list":I.value,"onUpdate:fileList":i[11]||(i[11]=e=>I.value=e),"image-mode":"aspectFill",action:M,disabled:1===z.value.state},null,8,["file-list","disabled"])])),_:1}),1!==z.value.state?(s(),a(U,{key:0,class:"footer"},{default:o((()=>[1===z.value.result?(s(),a(f,{key:0,type:"primary",size:"large",onClick:q,block:"",disabled:1===z.value.isReport},{default:o((()=>[d(" 隐患上报 ")])),_:1},8,["disabled"])):r("",!0),u(f,{type:"primary",size:"large",onClick:R,block:"",style:{"margin-top":"1rem"}},{default:o((()=>[d("提交")])),_:1})])),_:1})):r("",!0)])),_:1},8,["model"])])),_:1}),u(x),u(L)])),_:1})}}};export{C as default};
