import{r as e,q as l,l as a,a as o,b as u,h as r,o as s,e as t,j as m,s as i}from"./index-BP_ofNMV.js";import{_ as n,a as d,f as p}from"./wd-datetime-picker.C9Z9yD_Y.js";import{_ as v,r as c}from"./useChildren.CAjn426h.js";import{_ as b}from"./wd-textarea.BlajM10V.js";import{_ as f}from"./wd-select-picker.XdlqHHzA.js";import{_ as g}from"./wd-upload.Bm8wM8pF.js";import{_ as h}from"./wd-cell.RGUuOR8c.js";import{r as V,b as w,d as _,c as j}from"./request.D2K8nqXq.js";import{_ as U}from"./wd-form.BMurKPHh.js";import{_ as y}from"./wd-message-box.BqT4QVFO.js";import{_ as x}from"./wd-toast.CNyXT4Ng.js";/* empty css                                                               */import{f as k}from"./tree.DlTOYXzf.js";import"./index.ClTUV6O_.js";const L=v({__name:"accidentReport",setup(v){const L=e({discoverTime:"",discoverer:[]}),N=e();function T(){N.value.validate().then((({valid:e,errors:l})=>{if(e){const e={...L.value};e.time=p(e.time),e.fileList=[],S.value.forEach((l=>{if(l.response){const a=JSON.parse(l.response);e.fileList.push(a.data)}else e.fileList.push(l.url)}));const l=`/${j.mesMain}/accident/register/insert`;V({url:l,data:e,needAuth:!0,method:"POST"}).then((e=>{_({msg:"上报成功!"}),setTimeout((()=>{i({delta:1})}),500)}))}})).catch((e=>{console.log(e,"error")}))}const q=e([{label:"特别重大事故",value:1},{label:"重大事故",value:2},{label:"较大事故",value:3},{label:"一般事故",value:4}]),C=e([[{label:"请选择",value:-1}],[{label:"请选择",value:-1}]]);function D(e,l,a,o){const u=l[a];var r,s;0===a&&(r=u.value,s=l=>{e.setColumnData(1,l)},V({url:`/${j.mesUser}/sys/person/listSysPerson`,data:{orgCode:r,pageNum:1,pageSize:999},needAuth:!0,method:"GET"}).then((({list:e})=>{const l=[{label:"请选择",value:-1}];e.length>0&&e.forEach((e=>{l.push({...e,label:e.perName,value:e.perName})})),s(l)})))}function I({value:e,selectedItems:[l,a]}){L.value.injuredUser=a.perName,L.value.worknumber=a.workNumber,L.value.depatment=a.orgName,L.value.position=a.stationName}function E({value:e,selectedItems:[l,a]}){L.value.manager=a.perName}const P=e([{label:"手",value:"手"},{label:"脚",value:"脚"},{label:"头",value:"头"},{label:"眼睛",value:"眼睛"},{label:"面部",value:"面部"},{label:"腰",value:"腰"},{label:"腿",value:"腿"},{label:"胳膊",value:"胳膊"},{label:"躯干",value:"躯干"},{label:"其他",value:"其他"}]),$=e([{label:"机械伤害",value:"机械伤害"},{label:"化学伤害",value:"化学伤害"},{label:"物理伤害",value:"物理伤害"},{label:"生物伤害",value:"生物伤害"},{label:"电气伤害",value:"电气伤害"},{label:"运动伤害",value:"运动伤害"},{label:"热伤害及温度伤害",value:"热伤害及温度伤害"}]);e([{label:"一级",value:"一级"},{label:"二级",value:"二级"},{label:"三级",value:"三级"}]);const S=e([]),z=`${j.baseURL}/${j.mesMain}/accident/register/uploadFile`;return l((()=>{L.value.time=(new Date).getTime(),V({url:`/${j.mesUser}/sys/organization/listTree`,data:{},needAuth:!0,method:"GET"}).then((e=>{const l=k([e]);l.length>0&&(C.value[0]=[{label:"请选择",value:-1}],l.forEach((e=>{C.value[0].push({label:e.orgFullName,value:e.orgCode})})))}))})),(e,l)=>{const i=c(a("wd-picker"),n),p=c(a("wd-datetime-picker"),d),v=c(a("wd-textarea"),b),V=c(a("wd-select-picker"),f),_=c(a("wd-upload"),g),j=c(a("wd-cell"),h),k=c(a("wd-button"),w),A=r,F=c(a("wd-form"),U),G=c(a("wd-message-box"),y),M=c(a("wd-toast"),x);return s(),o(A,null,{default:u((()=>[t(A,null,{default:u((()=>[t(F,{ref_key:"form",ref:N,model:L.value,border:""},{default:u((()=>[t(i,{"align-right":"",prop:"discoverer",columns:C.value,label:"受伤人员",modelValue:L.value.discoverer,"onUpdate:modelValue":l[0]||(l[0]=e=>L.value.discoverer=e),"column-change":D,onConfirm:I,placeholder:"请选择上报人员",rules:[{required:!0,message:"请选择上报人员"}]},null,8,["columns","modelValue"]),t(p,{label:"发生时间","align-right":"",modelValue:L.value.time,"onUpdate:modelValue":l[1]||(l[1]=e=>L.value.time=e),prop:"time",rules:[{required:!0,message:"请填写发生时间"}]},null,8,["modelValue"]),t(i,{"align-right":"",columns:q.value,label:"事故类型",modelValue:L.value.type,"onUpdate:modelValue":l[2]||(l[2]=e=>L.value.type=e),prop:"type",rules:[{required:!0,message:"请选择事故类型"}]},null,8,["columns","modelValue"]),t(v,{label:"事件描述",modelValue:L.value.eventDescription,"onUpdate:modelValue":l[3]||(l[3]=e=>L.value.eventDescription=e),placeholder:"请填写详细的事件描述",maxlength:300,clearable:"","show-word-limit":"",prop:"eventDescription",rules:[{required:!0,message:"请填写详细的事件描述"}]},null,8,["modelValue"]),t(V,{"align-right":"",columns:P.value,label:"受伤部位",modelValue:L.value.injuredPartList,"onUpdate:modelValue":l[4]||(l[4]=e=>L.value.injuredPartList=e),prop:"injuredPartList",rules:[{required:!0,message:"请选择受伤部位"}]},null,8,["columns","modelValue"]),t(v,{label:"受伤情况描述",modelValue:L.value.injuredDescription,"onUpdate:modelValue":l[5]||(l[5]=e=>L.value.injuredDescription=e),placeholder:"",maxlength:300,clearable:"","show-word-limit":""},null,8,["modelValue"]),t(V,{"align-right":"",columns:$.value,label:"伤害类型",modelValue:L.value.injuredTypeList,"onUpdate:modelValue":l[6]||(l[6]=e=>L.value.injuredTypeList=e)},null,8,["columns","modelValue"]),t(j,{title:"附件上传",top:""},{default:u((()=>[t(_,{"file-list":S.value,"onUpdate:fileList":l[7]||(l[7]=e=>S.value=e),multiple:"","image-mode":"aspectFill",action:z},null,8,["file-list"])])),_:1}),t(i,{"align-right":"",prop:"managerItem",columns:C.value,label:"责任部门主管",modelValue:L.value.managerItem,"onUpdate:modelValue":l[8]||(l[8]=e=>L.value.managerItem=e),"column-change":D,onConfirm:E,placeholder:"请选择责任部门主管",rules:[{required:!0,message:"请选择责任部门主管"}]},null,8,["columns","modelValue"]),t(v,{label:"事故原因",modelValue:L.value.reason,"onUpdate:modelValue":l[9]||(l[9]=e=>L.value.reason=e),placeholder:"",maxlength:200,clearable:"","show-word-limit":""},null,8,["modelValue"]),t(v,{label:"整改措施",modelValue:L.value.measures,"onUpdate:modelValue":l[10]||(l[10]=e=>L.value.measures=e),placeholder:"",maxlength:200,clearable:"","show-word-limit":""},null,8,["modelValue"]),t(A,{class:"footer"},{default:u((()=>[t(k,{type:"primary",size:"large",onClick:T,block:"",class:"footer_button"},{default:u((()=>[m("提交")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),t(G),t(M)])),_:1})}}},[["__scopeId","data-v-82bdbfec"]]);export{L as default};
