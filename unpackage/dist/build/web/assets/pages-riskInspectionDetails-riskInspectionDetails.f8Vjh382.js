import{r as e,q as l,C as a,l as o,a as t,b as s,A as u,h as r,o as d,e as i,j as n,x as m,B as c,v as p}from"./index-4xE3Jiky.js";import{r as v,c as g,a as f,b as h}from"./request.BbQ2wDkA.js";import{l as b,p as k,r as V}from"./useChildren.ogl1P_NW.js";import{_ as y}from"./wd-select-picker.DCKp3YlI.js";import{_}from"./wd-textarea.C2NbIVsl.js";import{_ as w}from"./wd-cell.D49pC09f.js";import{_ as U}from"./wd-upload.r7andDs0.js";import{_ as j}from"./wd-form.D0YxAQUM.js";import{_ as x}from"./wd-message-box.D-XpZhdX.js";import{u as C,_ as T}from"./wd-toast.CSdeP_zF.js";import"./index.ClTUV6O_.js";const L={__name:"riskInspectionDetails",setup(L){e(-1);const{success:$}=C(),q=e(),F=e(),R=e();function A(){F.value.validate().then((({valid:e,errors:l})=>{if(e){const e=`/${g.mesMain}/riskcheck/execution/update`;v({url:e,data:q.value,needAuth:!0,method:"PUT"}).then((e=>{$({msg:"上报成功!"}),P()}))}})).catch((e=>{console.log(e,"error")}))}function D(){c({url:"/pages/riskReporting/riskReporting",success(e){e.eventChannel.emit("acceptDataFromOpenerPage",{id:q.value.id})}})}const E=[{label:"无风险",value:0},{label:"有风险",value:1}];const M=e([]),O=`${g.baseURL}/${g.mesMain}/accident/register/uploadFile`;function P(){v({url:`/${g.mesMain}/riskcheck/execution/getBy/${R.value}`,data:{},needAuth:!0,method:"GET"}).then((e=>{e||(e={}),e.result=e.result||0===e.result?e.result:1,M.value=[],e.photoList&&e.photoList.length>0&&e.photoList.forEach((e=>{M.value.push({url:e})})),q.value=e})).finally((()=>{u()}))}return l((()=>{a().proxy.getOpenerEventChannel().on("acceptDataFromOpenerPage",(function(e){console.log(e,e.id),R.value=e.id,P()}))})),b((()=>{P()})),k((()=>{q.value&&P()})),(e,l)=>{const a=V(o("wd-input"),f),u=V(o("wd-select-picker"),y),c=V(o("wd-textarea"),_),v=V(o("wd-cell"),w),g=V(o("wd-upload"),U),b=V(o("wd-button"),h),k=r,C=V(o("wd-form"),j),L=V(o("wd-message-box"),x),$=V(o("wd-toast"),T);return d(),t(k,null,{default:s((()=>[i(k,{v:""},{default:s((()=>[i(C,{ref_key:"form",ref:F,model:q.value,border:"",disabled:"",v:""},{default:s((()=>[i(a,{"align-right":"",modelValue:q.value.planCheckTime,"onUpdate:modelValue":l[0]||(l[0]=e=>q.value.planCheckTime=e),label:"计划开始时间",readonly:""},null,8,["modelValue"]),i(a,{"align-right":"",modelValue:q.value.checkType,"onUpdate:modelValue":l[1]||(l[1]=e=>q.value.checkType=e),label:"检查类别",readonly:""},null,8,["modelValue"]),i(a,{"align-right":"",modelValue:q.value.checkCriteria,"onUpdate:modelValue":l[2]||(l[2]=e=>q.value.checkCriteria=e),label:"检查标准",readonly:""},null,8,["modelValue"]),i(a,{"align-right":"",modelValue:q.value.checkUser,"onUpdate:modelValue":l[3]||(l[3]=e=>q.value.checkUser=e),label:"检查人",readonly:""},null,8,["modelValue"]),i(a,{"align-right":"",modelValue:q.value.area,"onUpdate:modelValue":l[4]||(l[4]=e=>q.value.area=e),label:"区域",readonly:""},null,8,["modelValue"]),i(a,{"align-right":"",modelValue:q.value.content,"onUpdate:modelValue":l[5]||(l[5]=e=>q.value.content=e),label:"内容",readonly:""},null,8,["modelValue"]),i(u,{"align-right":"",label:"巡检结果",modelValue:q.value.result,"onUpdate:modelValue":l[6]||(l[6]=e=>q.value.result=e),columns:E,"show-confirm":!1,type:"radio",prop:"sign",rules:[{required:!0,message:"请选扫描区域编码"}],disabled:1===q.value.state},null,8,["modelValue","disabled"]),i(v,{title:"备注",top:""},{default:s((()=>[i(c,{modelValue:q.value.remark,"onUpdate:modelValue":l[7]||(l[7]=e=>q.value.remark=e),disabled:1===q.value.state},null,8,["modelValue","disabled"])])),_:1}),i(a,{"align-right":"",modelValue:q.value.sign,"onUpdate:modelValue":l[8]||(l[8]=e=>q.value.sign=e),label:"区域编码","suffix-icon":"scan",readonly:"",onClick:l[9]||(l[9]=e=>{1!==q.value.state&&p({success:function(e){console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),q.value.sign=e.result}})}),prop:"sign",rules:[{required:!0,message:"请选扫描区域编码"}]},null,8,["modelValue"]),i(v,{title:"现场图片上传",top:""},{default:s((()=>[i(g,{"file-list":M.value,"onUpdate:fileList":l[10]||(l[10]=e=>M.value=e),"image-mode":"aspectFill",action:O,disabled:1===q.value.state},null,8,["file-list","disabled"])])),_:1}),1!==q.value.state?(d(),t(k,{key:0,class:"footer"},{default:s((()=>[1===q.value.result?(d(),t(b,{key:0,type:"primary",size:"large",onClick:D,block:"",disabled:1===q.value.isReport},{default:s((()=>[n(" 隐患上报 ")])),_:1},8,["disabled"])):m("",!0),i(b,{type:"primary",size:"large",onClick:A,block:"",style:{"margin-top":"1rem"}},{default:s((()=>[n("提交")])),_:1})])),_:1})):m("",!0)])),_:1},8,["model"])])),_:1}),i(L),i($)])),_:1})}}};export{L as default};
